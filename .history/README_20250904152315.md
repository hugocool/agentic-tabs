# Agentic Tabs Extension

Plasmo + LangGraph.js powered browser extension for agentic tab triage, New Tab replacement, per-window Manager tab, Notion integration, and AI-assisted classification.

## Features

- Overrides New Tab with a dashboard (`chrome_url_overrides.newtab`).
- Pins a Manager tab (index 0, pinned) in every new window automatically.
- Maintains a sessionId → windowIds mapping in `chrome.storage.session`.
- LangGraph pipeline: collect → classify → upsert (Notion) → act (close/group tabs).
- On-device classifier via Chrome Prompt API (Gemini Nano) with cloud fallback for Edge/other Chromium.
- Notion upsert: resources (by URL) + session page with relations.
- Safe Zod validation for model output.

## Project Structure

```
src/
  newtab.tsx              # New Tab Page UI
  pages/manager.tsx       # Pinned per-window Manager UI
  background/index.ts     # Background events & messaging
  background/graph.ts     # LangGraph workflow + runGraph()
  background/ai.ts        # Classifier (Prompt API + fallback)
  background/notion.ts    # Notion upsert helpers
  background/session-map.ts # Session mapping utilities
```

## Install & Run (Dev)

```bash
pnpm install
pnpm dev
```

Load the generated development build folder (Plasmo prints the path) as an unpacked extension:

Chrome: chrome://extensions → Developer Mode → Load unpacked → select build dir.

Edge: edge://extensions → Developer Mode → Load unpacked → select build dir.

## Notion Setup

1. Create an internal integration in Notion; copy the secret token.
2. Create / identify two databases: Resources & Sessions.
3. Share both databases with the integration.
4. After loading the extension, run in the extension background page console:

   ```js
   chrome.storage.local.set({
     notionToken: "secret_xxx",
     resourcesDbId: "<resources-db-id>
     sessionsDbId: "<sessions-db-id>"
   })
   ```

Recommended DB properties (Resources): Name (title), URL (url), Status (select), Decision (select), Group/Project/Task (rich text). Sessions DB: Name (title), SavedAt (date), Resources (relation).

## Running a Session

1. Open New Tab → Start session.
2. Browse; open more windows (each gets a Manager tab). All windows get tied to their own session automatically (simplified approach: first window per creation event). Optionally adapt logic to merge windows under one session.
3. Click "Run triage" (New Tab) or "Save & Clean" (Manager) to classify, upsert, and tidy tabs.

## Edge Notes

- Prompt API is Chrome-only currently—Edge will immediately use the cloud fallback.
- New Tab override & tab grouping APIs work in Edge (Chromium parity).
- If adding a side panel, Edge uses its Sidebar API (adjust feature-detection accordingly).

## Security / Distribution

- Internal integration token is stored locally (development). For distribution, implement OAuth & a backend relay; never ship raw tokens.
- Validate & sanitize model outputs (Zod already narrows structure; add further guards as needed).

## Next Steps / Ideas

- Session persistence across browser restarts (persist map to `storage.local`).
- Resume UI: list sessions & reopen kept tabs explicitly.
- More granular actions (archive vs drop → different closing strategies).
- Enhanced grouping (color coding by project).
- Cloud classifier endpoint with auth + rate limiting.

## License

Prototype code – adapt licensing as needed.
